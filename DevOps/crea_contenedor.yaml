---
- name: Crea Imagen de Contenedor
  hosts: all
#  connection: local
  gather_facts: false
  remote_user: opc

  vars_files:
    - ../vault.yaml
    - ../variables.yaml

  tasks:
  - name: Clona Repositorio Git
    ansible.builtin.git:
      repo: "{{ url_git }}"
      dest: "/tmp/Race-to-the-Cloud-app"

#  - name: Crea Servicio
#    shell: "podman generate systemd --new --name podman -f ~/podman.service"

#  - name: Copia Servicio
#    shell: "mv -v ~/podman.service ~/.config/systemd/user/"
#  - name: Recrea
#    shell: "systemctl daemon-reload"

#  - name: Levanta Servicio Podman
#    ansible.builtin.systemd: 
#      name: podman.service
#      state: started
#      scope: user
#


  - name: Build Imagen de Contenedor
    shell: "podman build --tag ci-app /tmp/Race-to-the-Cloud-app/"

  - name: Tag Imagen
    shell: "podman tag localhost/ci-app:latest scl.ocir.io/axmdrz5zetbw/cp-app:latest"

  - name: Push Imagen
    shell: "podman push scl.ocir.io/axmdrz5zetbw/ci-app:latest"
